<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JBR7 Bags - Sign In</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Load Poppins for a cleaner UI on the auth pages -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/JBR7 CSS/signin.css">
    <style>
        /* Back button for auth pages */
        
    </style>
</head>
<body>
    
    <div class="logo-container">
        <img src="JBR7 BAGS LOGO.jpg" alt="JBR7 BAGS LOGO" class="logo-image" onerror="this.style.display='none'">

    <div class="logo-text">
        <span class="brand-name"></span>
        <span class="brand-tagline">MANUFACTURING</span>
    </div>
</div>
    
 

    <div class="auth-card">
        <!-- Single-mode auth: Sign In only -->
        <h2 style="text-align:center;margin-bottom:12px;color:#333;font-size:1.35rem">Sign In</h2>

    <form id="signin-form" action="/jbr7php/signin.php" method="POST">
            <div class="form-group">
                <label>Email address</label>
                <input type="email" name="email" placeholder="Enter your email address" required>
            </div>

            <div class="form-group">
                <label>Password</label>
                <div class="input-container">
                    <input type="password" name="password" placeholder="Enter your password" required>
                    <i class="fa-regular fa-eye-slash eye-icon" onclick="(function(i){const inp=i.parentElement.querySelector('input'); if(inp.type==='password'){inp.type='text'; i.classList.remove('fa-eye-slash'); i.classList.add('fa-eye');} else {inp.type='password'; i.classList.remove('fa-eye'); i.classList.add('fa-eye-slash');}})(this)"></i>
                </div>
            </div>

            <div class="form-options">
                <label class="remember-me">
                    <input type="checkbox"> Remember me
                </label>
                <a href="#" class="forgot-pass">Forgot password</a>
            </div>

            <button class="main-btn" type="submit" id="signin-submit-btn">Sign In</button>
            <div id="signin-error" style="display:none;color:#e53e3e;text-align:center;margin-top:1rem;font-size:0.9rem;"></div>

            <div class="divider">OR</div>
            <div style="text-align:center;margin-top:0.6rem">
                <a href="index.html" class="return-home">Return to home</a>
            </div>
            <div style="text-align:center;margin-top:0.6rem">
                <span style="color:#333;margin-right:6px">Don't have an account?</span>
                <a href="signup.html" class="return-home">Sign Up</a>
            </div>
        </form>
    </div>
    
    <script>
        // Intercept form submission to set user ID immediately
        document.getElementById('signin-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const form = this;
            const submitBtn = document.getElementById('signin-submit-btn');
            const errorDiv = document.getElementById('signin-error');
            const email = form.querySelector('input[name="email"]').value;
            const password = form.querySelector('input[name="password"]').value;
            
            // Show loading state
            submitBtn.disabled = true;
            submitBtn.textContent = 'Signing in...';
            errorDiv.style.display = 'none';
            
            // Submit via AJAX
            const formData = new FormData();
            formData.append('email', email);
            formData.append('password', password);
            
            fetch('/jbr7php/signin.php', {
                method: 'POST',
                body: formData,
                credentials: 'same-origin',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => {
                if (response.ok) {
                    return response.json();
                }
                return response.json().then(err => Promise.reject(err));
            })
            .then(data => {
                if (data.success) {
                    // CRITICAL: Set user ID immediately in sessionStorage before redirect
                    if (data.user_id) {
                        sessionStorage.setItem('jbr7_user_id', data.user_id.toString());
                        console.log('User ID set immediately:', data.user_id);
                    }
                    
                    // Clear any legacy/guest cart data
                    if (typeof UserStorage !== 'undefined' && UserStorage && UserStorage.clearLegacyData) {
                        UserStorage.clearLegacyData();
                    }
                    
                    // Redirect to home
                    window.location.href = '/home.html';
                } else {
                    throw new Error(data.error || 'Login failed');
                }
            })
            .catch(error => {
                console.error('Login error:', error);
                errorDiv.textContent = error.error || error.message || 'Login failed. Please try again.';
                errorDiv.style.display = 'block';
                submitBtn.disabled = false;
                submitBtn.textContent = 'Sign In';
            });
        });
    </script>
</body>
</html>